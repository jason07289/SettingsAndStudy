# 쿠키와 세션

## 1. HTTP의 특징
### 1.1 Connectionless(비연결 지향)
- 클라이언트에서 서버에 요청을 보내면 서버는 클라이언트에 응답을 하고 접속을 끊는 특성이 있다.(HTTP 1.1에서 Connection 헤더에 keep-alive라고 설정하면 커넥션을 유지할 수 있다)
### 1.2 Stateless(상태정보 유지 X)
- HTTP 통신은 요청을 응답하고 접속을 끊기 때문에 클라이언트의 상태정보를 알 수 없다.
- 로그인 등으로 상태를 유지한 채로 웹 서비스를 제공하기 위해서 쿠키와 세션이 존재한다.

## 2. Cookie
쿠키는 클라이언트 로컬에 저장되는 Key-Value 쌍의 작은 데이터 파일.

### 2.1 구성요소
- 쿠키이름, 쿠키값, 만료시간, 전송할 도메인명, 전송할 경로, 보안연결여부, HttpOnly 여부
### 2.2 동작방식
![image](https://user-images.githubusercontent.com/38865267/97663348-a63b2580-1abc-11eb-9399-87d8454c7560.png)
1. 클라이언트가 서버에 로그인 요청을 한다.
2. 서버는 클라이언트의 로그인 요청의 유효성을 확인하고(아이디와 비밀번호 검사) 응답헤더에 set-cookie: user=chrisjune 를 추가하여 응답.
3. 클라이언트는 이후 서버에 요청할 때 전달받은 cookie: user=chrisjune 쿠키를 자동으로 요청헤더에 추가하여 요청. 헤더에 쿠키값을 자동으로 추가하여 주는데 이는 브라우저에서 처리해주는 작업니다.

### 2.3 쿠키값 확인 방법
- 브라우저 개발자도구의 네트워크에서 쿠키값을 확인할 수 있지만, 가독성이 떨어지고 수정이 불가.
- 브라우저의 쿠키관리 탭 또는 쿠키관리 플러그인을 설치하면 쿠키를 쉽게 수정할 수 있다.
- 쿠키는 클라이언트에서 수정할 수 있기 때문에 쿠키값(value)를 암호화해야 더욱 안전.

## 3. Session
브라우저가 종료되기 전까지 클라이언트의 요청을 유지하게 해주는 기술

### 3.1 동작방식
![image](https://user-images.githubusercontent.com/38865267/97666388-e7353900-1ac0-11eb-869c-ec2c9e22a96e.png)
1. 클라이언트가 서버에 로그인 요청을 합니다.
2. 서버는 클라이언트의 로그인 요청의 유효성을 확인하고(ID, PW 검사) unique한 id를 sessionid라는 이름으로 저장.
3. 서버가 응답할 때 응답헤더에 set-cookie: sessionid:a1x2fjz를 추가하여 응답합니다.
4. 클라이언트는 이후 서버에 요청할 때 전달받은 sessionid:a1x2fjz 쿠키를 자동으로 요청헤더에 추가하여  요청합니다.
5. 서버에서는 요청헤더의 sessionid 값을 저장된 세션저장소에서 찾아보고 유효한지 확인 후 요청을 처리하고 응답.
- 세션의 내용은 서버에 저장되기 때문에 계속하여 늘어날 경우 서버에 부하가 발생.

### 4. 쿠키와 세션의 차이점
쿠키와 세션의 차이점은 총 4가지
- 저장위치
  - 쿠키는 로컬에, 세션은 로컬과 서버에 저장.
- 보안
  - 쿠키는 탈취와 변조가 가능하지만, 세션은 ID값만 가지고 있고서버에도 저장이 되어있기 때문에 상대적으로 안전.
- Lifecycle
  - 쿠키는 브라우저를 종료해도 파일로 남아있지만, 세션은 브라우저 종료시 세션을 삭제.
- 속도
  - 쿠키는 파일에서 읽기 때문에 상대적으로 빠르고 세션은 요청마다 서버에서 처리를 해야하므로 상대적으로 느리다.
